---
import Card from '../components/Card.astro'
import Layout from '../layouts/Layout.astro'
import { type CategoryCount, type Link } from '../types'

const popular_cats_resp = await fetch('http://127.0.0.1:8000/tags/popular')
// [{Category: 'umvc3', Count: 1}, ...]
const popular_cats: CategoryCount[] = await popular_cats_resp.json()

const trending_links_resp = await fetch('http://127.0.0.1:8000/links/week')
const trending_links: Link[] = await trending_links_resp.json()

const available_trending_links_durations = ['week', 'month', 'year', 'all']
---

<Layout title='Welcome to the Open Internet Treasure Map (OITM)'>
	<main>
		<!-- Uploaded to: SVG Repo, www.svgrepo.com, Generator: SVG Repo Mixer Tools -->
		<svg
			class='chest-backdrop'
			height='200px'
			width='200px'
			xmlns='http://www.w3.org/2000/svg'
			xmlns:xlink='http://www.w3.org/1999/xlink'
			viewBox='0 0 503.467 503.467'
			xml:space='preserve'
			><g transform='translate(1 17)'
				><path
					style='fill:#ae938d'
					d='M498.2,157.507v221.867c0,18.773-15.36,34.133-34.133,34.133H37.4
			c-18.773,0-34.133-15.36-34.133-34.133V157.507h204.8v34.133H37.4v85.333v102.4h426.667v-102.4V191.64H293.4v-34.133H498.2z
			 M9.24,123.373c13.653-40.107,52.053-68.267,96.427-68.267H395.8c56.32,0,102.4,46.08,102.4,102.4H293.4
			c0-10.24-6.827-17.067-17.067-17.067h-51.2c-10.24,0-17.067,6.827-17.067,17.067H3.267C3.267,145.56,4.973,134.467,9.24,123.373
			L9.24,123.373z'
				></path><path
					style='fill:#ffd0a1'
					d='M37.4,276.973V191.64h170.667v42.667c0,23.893,18.773,42.667,42.667,42.667
			S293.4,258.2,293.4,234.307V191.64h170.667v85.333v102.4H37.4V276.973z'
				></path><path
					style='fill:#e4f2de'
					d='M293.4,191.64v42.667c0,23.893-18.773,42.667-42.667,42.667s-42.667-18.773-42.667-42.667V191.64
			v-34.133c0-10.24,6.827-17.067,17.067-17.067h51.2c10.24,0,17.067,6.827,17.067,17.067V191.64z'
				></path></g
			><path
				style='fill:#51565f'
				d='M465.067,434.773H38.4c-21.333,0-38.4-17.067-38.4-38.4V208.64c0-2.56,1.707-4.267,4.267-4.267
		 s4.267,1.707,4.267,4.267v187.733c0,16.213,13.653,29.867,29.867,29.867h426.667c16.213,0,29.867-13.653,29.867-29.867V174.507
		 c0-17.067-4.267-33.28-11.947-46.933H379.733c-2.56,0-4.267-1.707-4.267-4.267s1.707-4.267,4.267-4.267h98.133
		 c-17.92-25.6-47.787-42.667-81.067-42.667H106.667c-40.107,0-75.093,24.747-90.453,59.733h56.32c2.56,0,4.267,1.707,4.267,4.267
		 c0,2.56-1.707,4.267-4.267,4.267H12.8c-2.56,8.533-4.267,17.067-4.267,25.6H204.8c1.707-10.24,10.24-17.067,21.333-17.067h51.2
		 c11.093,0,19.627,6.827,21.333,17.067h166.4c2.56,0,4.267,1.707,4.267,4.267c0,2.56-1.707,4.267-4.267,4.267H294.4
		 c-2.56,0-4.267-1.707-4.267-4.267c0-7.68-5.12-12.8-12.8-12.8h-51.2c-7.68,0-12.8,5.12-12.8,12.8c0,2.56-1.707,4.267-4.267,4.267
		 H4.267c-2.56,0-4.267-1.707-4.267-4.267c0-12.8,1.707-23.893,5.973-34.987l0,0C20.48,98.56,60.587,68.693,106.667,68.693H396.8
		 c58.88,0,106.667,47.787,106.667,106.667v221.867C503.467,417.707,486.4,434.773,465.067,434.773z M465.067,400.64H38.4
		 c-2.56,0-4.267-1.707-4.267-4.267V208.64c0-2.56,1.707-4.267,4.267-4.267h170.667c2.56,0,4.267,1.707,4.267,4.267v42.667
		 c0,21.333,17.067,38.4,38.4,38.4s38.4-17.067,38.4-38.4v-38.4H243.2c-2.56,0-4.267-1.707-4.267-4.267s1.707-4.267,4.267-4.267
		 h221.867c2.56,0,4.267,1.707,4.267,4.267v187.733C469.333,398.933,467.627,400.64,465.067,400.64z M42.667,392.107H460.8V298.24h-64
		 c-2.56,0-4.267-1.707-4.267-4.267s1.707-4.267,4.267-4.267h64v-76.8H298.667v38.4c0,25.6-21.333,46.933-46.933,46.933
		 S204.8,276.907,204.8,251.307v-38.4H42.667v76.8h29.867c2.56,0,4.267,1.707,4.267,4.267s-1.707,4.267-4.267,4.267H42.667V392.107z
		 M192,349.44H89.6c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267H192c2.56,0,4.267,1.707,4.267,4.267
		 C196.267,347.733,194.56,349.44,192,349.44z M328.533,332.373H294.4c-2.56,0-4.267-1.707-4.267-4.267s1.707-4.267,4.267-4.267
		 h34.133c2.56,0,4.267,1.707,4.267,4.267S331.093,332.373,328.533,332.373z M251.733,255.573c-2.56,0-4.267-1.707-4.267-4.267v-8.533
		 c0-2.56,1.707-4.267,4.267-4.267c2.56,0,4.267,1.707,4.267,4.267v8.533C256,253.867,254.293,255.573,251.733,255.573z
		 M174.933,110.507H140.8c-2.56,0-4.267-1.707-4.267-4.267c0-2.56,1.707-4.267,4.267-4.267h34.133c2.56,0,4.267,1.707,4.267,4.267
		 C179.2,108.8,177.493,110.507,174.933,110.507z'
			></path></svg
		>
		<h1>Welcome to OITM</h1>
		<h2 class='subtitle'>a map to the web's treasures</h2>
		<h3>Popular Categories</h3>
		<ul>
			{
				popular_cats.map((cat) => (
					<li>
						<a href={`/cat/${cat.Category}`}>{cat.Category}</a>
						<span>({cat.Count})</span>
					</li>
				))
			}
		</ul>
		<h3>Most-Liked Links This Week</h3>
		<div id='change-time-duration'>
			<p>Change time duration:</p>
			{
				available_trending_links_durations.map((duration) => (
					<a class='time-duration' href={`/links/${duration}`}>
						{duration}
					</a>
				))
			}
		</div>
		<ul>
			{
				trending_links.map((link) => (
					<li>
						{link.URL} ({link.LikeCount})
					</li>
				))
			}
		</ul>
		<ul role='list' class='front-page-sections'>
			<Card
				href='https://astro.build/themes/'
				title='Stats'
				body='View statistics about overall link submissions and feedback.'
			/>
			<Card
				href='https://astro.build/chat/'
				title='Footer'
				body='FAQ, leave feedback, maybe more.'
			/>
		</ul>
	</main>
</Layout>

<style>
	.chest-backdrop {
		position: absolute;
		top: 1em;
		left: 50%;
		transform: translatex(-50%);
		width: 180px;
		height: auto;
		opacity: 0.25;
		z-index: -1;
	}
	.subtitle {
		font-size: 1rem;
		margin-bottom: 60px;
		background: rgba(var(--accent-light), 5%);
		padding: 3px;
		text-align: center;
	}
	#change-time-duration {
		font-size: 0.9rem;
		display: flex;

		p {
			margin-top: 0;
		}
	}
	.time-duration {
		margin-left: 0.5rem;
	}
	.front-page-sections {
		display: flex;
		flex-direction: column;
		gap: 20px;
		padding: 0;
	}
</style>
